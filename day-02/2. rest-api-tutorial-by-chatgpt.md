ржЪржорзОржХрж╛рж░ Md. Mojnu Miah ржнрж╛ржЗ тЭдя╕П тАФ рждрзБржорж┐ ржпрзЗржнрж╛ржмрзЗ рж╢рж┐ржЦржЫ, рж╕рзЗржЯрж╛ *world-class developer mindset*ред ржПржЦржи ржЖржорж░рж╛ **Laravel-ржПрж░ ржкрзНржпрж╛ржЯрж╛рж░рзНржирзЗ PHP (PDO + JWT)** ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржПржХржЯрж┐ **Professional REST API Project** рждрзИрж░рж┐ ржХрж░ржмред
ржЖржорж┐ ржзрж╛ржкрзЗ ржзрж╛ржкрзЗ рж▓рж┐ржЦржм, ржПржХржжржо **рж╕рж░рж▓ ржнрж╛рж╖рж╛рзЯ**, ржХрж┐ржирзНрждрзБ **ржкрзНрж░ржлрзЗрж╢ржирж╛рж▓ржнрж╛ржмрзЗ рж╕рж╛ржЬрж╛ржирзЛ** ржпрзЗржи рждрзБржорж┐ VS Code-ржП ржлрж▓рзЛ ржХрж░рждрзЗ ржкрж╛рж░рзЛ ржПржмржВ ржмрзБржЭрждрзЗ ржкрж╛рж░рзЛ ржХрзА рж╣ржЪрзНржЫрзЗред

---

## ЁЯОп ржкрзНрж░ржЬрзЗржХрзНржЯрзЗрж░ ржирж╛ржо

**mini-php-api**

---

## ЁЯз▒ ржлрзЛрж▓рзНржбрж╛рж░ рж╕рзНржЯрзНрж░рж╛ржХржЪрж╛рж░ (Laravel pattern ржЕржирзБрж╕рж╛рж░рзЗ)

ржЖржорж░рж╛ Laravel-ржПрж░ ржоржд **MVC pattern** ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржм (Model, Controller, Routes, Config ржЗрждрзНржпрж╛ржжрж┐)ред

```
mini-php-api/
тФВ
тФЬтФАтФА app/
тФВ   тФЬтФАтФА Controllers/
тФВ   тФВ   тФЬтФАтФА AuthController.php
тФВ   тФВ   тФЬтФАтФА ProductController.php
тФВ   тФВ   тФФтФАтФА CheckoutController.php
тФВ   тФВ
тФВ   тФЬтФАтФА Models/
тФВ   тФВ   тФЬтФАтФА User.php
тФВ   тФВ   тФФтФАтФА Product.php
тФВ
тФЬтФАтФА config/
тФВ   тФФтФАтФА database.php
тФВ
тФЬтФАтФА routes/
тФВ   тФФтФАтФА api.php
тФВ
тФЬтФАтФА core/
тФВ   тФЬтФАтФА Database.php
тФВ   тФЬтФАтФА JWT.php
тФВ   тФФтФАтФА Response.php
тФВ
тФЬтФАтФА .env
тФЬтФАтФА composer.json
тФФтФАтФА index.php
```

---

## ЁЯзй Step 1: Database Configuration

**File:** `config/database.php`

```php
<?php
return [
  'host' => 'localhost',
  'dbname' => 'mini_api',
  'username' => 'root',
  'password' => '',
];
```

---

## ЁЯзй Step 2: Database Connection Class

**File:** `core/Database.php`

```php
<?php
class Database {
  private static $instance = null;
  private $pdo;

  private function __construct() {
    $config = include __DIR__ . '/../config/database.php';

    try {
      $this->pdo = new PDO(
        "mysql:host={$config['host']};dbname={$config['dbname']}",
        $config['username'],
        $config['password'],
        [PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION]
      );
    } catch (PDOException $e) {
      die("Database connection failed: " . $e->getMessage());
    }
  }

  public static function getInstance() {
    if (self::$instance === null) {
      self::$instance = new Database();
    }
    return self::$instance->pdo;
  }
}
```

---

## ЁЯзй Step 3: JWT Helper Class

**File:** `core/JWT.php`

```php
<?php
class JWT {
  private static $secret = 'YOUR_SECRET_KEY';

  public static function encode($payload) {
    $header = base64_encode(json_encode(['alg' => 'HS256', 'typ' => 'JWT']));
    $payload = base64_encode(json_encode($payload));
    $signature = hash_hmac('sha256', "$header.$payload", self::$secret, true);
    return "$header.$payload." . base64_encode($signature);
  }

  public static function decode($token) {
    $parts = explode('.', $token);
    if (count($parts) !== 3) return false;

    $signature = base64_decode($parts[2]);
    $expected = hash_hmac('sha256', "$parts[0].$parts[1]", self::$secret, true);
    return hash_equals($signature, $expected)
      ? json_decode(base64_decode($parts[1]), true)
      : false;
  }
}
```

---

## ЁЯзй Step 4: User Model

**File:** `app/Models/User.php`

```php
<?php
require_once __DIR__ . '/../../core/Database.php';

class User {
  private $db;

  public function __construct() {
    $this->db = Database::getInstance();
  }

  public function findByEmail($email) {
    $stmt = $this->db->prepare("SELECT * FROM users WHERE email = ?");
    $stmt->execute([$email]);
    return $stmt->fetch(PDO::FETCH_ASSOC);
  }
}
```

---

## ЁЯзй Step 5: AuthController (Login API)

**File:** `app/Controllers/AuthController.php`

```php
<?php
require_once __DIR__ . '/../../app/Models/User.php';
require_once __DIR__ . '/../../core/JWT.php';

class AuthController {
  public function login() {
    $input = json_decode(file_get_contents("php://input"), true);

    $email = $input['email'] ?? '';
    $password = $input['password'] ?? '';

    $userModel = new User();
    $user = $userModel->findByEmail($email);

    if (!$user || !password_verify($password, $user['password'])) {
      http_response_code(401);
      echo json_encode(["error" => "Invalid credentials"]);
      return;
    }

    $token = JWT::encode(['id' => $user['id'], 'email' => $user['email'], 'time' => time()]);
    echo json_encode(["token" => $token]);
  }
}
```

---

## ЁЯзй Step 6: ProductController (Products & Product Details)

**File:** `app/Controllers/ProductController.php`

```php
<?php
require_once __DIR__ . '/../../core/Database.php';

class ProductController {
  private $db;

  public function __construct() {
    $this->db = Database::getInstance();
  }

  public function getAllProducts() {
    $stmt = $this->db->query("SELECT id, name, price FROM products");
    echo json_encode($stmt->fetchAll(PDO::FETCH_ASSOC));
  }

  public function getProductDetails($id) {
    $stmt = $this->db->prepare("SELECT * FROM products WHERE id = ?");
    $stmt->execute([$id]);
    echo json_encode($stmt->fetch(PDO::FETCH_ASSOC));
  }
}
```

---

## ЁЯзй Step 7: CheckoutController

**File:** `app/Controllers/CheckoutController.php`

```php
<?php
require_once __DIR__ . '/../../core/JWT.php';
require_once __DIR__ . '/../../core/Database.php';

class CheckoutController {
  public function checkout() {
    $headers = getallheaders();
    $token = $headers['Authorization'] ?? '';

    $user = JWT::decode(str_replace('Bearer ', '', $token));

    if (!$user) {
      http_response_code(401);
      echo json_encode(["error" => "Unauthorized"]);
      return;
    }

    $input = json_decode(file_get_contents("php://input"), true);
    $productId = $input['product_id'] ?? null;

    echo json_encode([
      "message" => "Checkout successful",
      "user" => $user['email'],
      "product_id" => $productId
    ]);
  }
}
```

---

## ЁЯзй Step 8: Routes

**File:** `routes/api.php`

```php
<?php
require_once __DIR__ . '/../app/Controllers/AuthController.php';
require_once __DIR__ . '/../app/Controllers/ProductController.php';
require_once __DIR__ . '/../app/Controllers/CheckoutController.php';

$uri = parse_url($_SERVER['REQUEST_URI'], PHP_URL_PATH);
$method = $_SERVER['REQUEST_METHOD'];

switch (true) {
  case $uri === '/api/login' && $method === 'POST':
    (new AuthController())->login();
    break;

  case $uri === '/api/products' && $method === 'GET':
    (new ProductController())->getAllProducts();
    break;

  case preg_match('#^/api/products/(\d+)$#', $uri, $matches) && $method === 'GET':
    (new ProductController())->getProductDetails($matches[1]);
    break;

  case $uri === '/api/checkout' && $method === 'POST':
    (new CheckoutController())->checkout();
    break;

  default:
    http_response_code(404);
    echo json_encode(["error" => "Route not found"]);
}
```

---

## ЁЯзй Step 9: Index File

**File:** `index.php`

```php
<?php
header("Content-Type: application/json");
require_once __DIR__ . '/routes/api.php';
```

---

## ЁЯзй Step 10: Test the APIs (using Postman)

| Endpoint             | Method | Description               | Auth                 |
| -------------------- | ------ | ------------------------- | -------------------- |
| `/api/login`         | POST   | Login with email/password | тЭМ                    |
| `/api/products`      | GET    | Get all products          | тЭМ                    |
| `/api/products/{id}` | GET    | Get product details       | тЭМ                    |
| `/api/checkout`      | POST   | Checkout product          | тЬЕ JWT Token required |

---

## тЬЕ Example Request for `/api/login`

```json
{
  "email": "user@example.com",
  "password": "123456"
}
```

**Response:**

```json
{
  "token": "eyJhbGciOi..."
}
```

---

## ЁЯОУ рждрзБржорж┐ ржпрж╛ рж╢рж┐ржЦрж▓рзЗ

1. ржХрзАржнрж╛ржмрзЗ **PDO ржжрж┐рзЯрзЗ secure query** ржХрж░рж╛ ржпрж╛рзЯ
2. ржХрзАржнрж╛ржмрзЗ **JWT ржжрж┐рзЯрзЗ authentication** ржХрж░рж╛ рж╣рзЯ
3. ржХрзАржнрж╛ржмрзЗ **Laravel-ржПрж░ ржорждрзЛ folder structure** рж░рж╛ржЦрж╛ ржпрж╛рзЯ
4. ржХрзАржнрж╛ржмрзЗ **REST API endpoints** рждрзИрж░рж┐ ржХрж░рж╛ рж╣рзЯ

---

ржЪрж╛ржУ ржХрж┐ ржЖржорж┐ ржПржЦржи ржПрж░ ржЬржирзНржп ржПржХржЯрж┐ **MySQL database.sql file** ржмрж╛ржирж┐рзЯрзЗ ржжрж┐ржЗ (users + products table рж╕рж╣ ready data)?
рждрж╛рж╣рж▓рзЗ рждрзБржорж┐ рж╕рж░рж╛рж╕рж░рж┐ Import ржХрж░рзЗ ржЯрзЗрж╕рзНржЯ ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗред
